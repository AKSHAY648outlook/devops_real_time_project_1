---
- name: IMAGE PUSH
  hosts: all
  remote_user: root
  tasks:
    - name: PUSH IMAGE ON DOCKERHUB REGISTRY
      shell: |
        cd /opt/docker
        docker build -t {{ JOB_NAME }}:v1.{{ BUILD_ID }} .
        docker tag {{ JOB_NAME }}:v1.{{ BUILD_ID }} sunnydevops2022/{{ JOB_NAME }}:v1.{{ BUILD_ID }}
        docker tag {{ JOB_NAME }}:v1.{{ BUILD_ID }} sunnydevops2022/{{ JOB_NAME }}:latest
        docker login -u {{ DOCKERHUB_USER }} --password {{ DOCKERHUB_PASS }}
        docker push sunnydevops2022/{{ JOB_NAME }}:v1.{{ BUILD_ID }}
        docker push sunnydevops2022/{{ JOB_NAME }}:latest
        docker rmi {{ JOB_NAME }}:v1.{{ BUILD_ID }} sunnydevops2022/{{ JOB_NAME }}:v1.{{ BUILD_ID }} sunnydevops2022/{{ JOB_NAME }}:latest
        docker logout

